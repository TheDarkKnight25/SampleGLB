<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>3D Model Viewer</title>
	<style>
		#canvas {
			width: 100%;
			height: 100%;
			position: absolute;
			top: 0;
			left: 0;
		}
	</style>
</head>
<body>
	<div id="canvas"></div>
	<script src="https://threejs.org/build/three.js"></script>
	<script src="https://threejs.org/examples/js/controls/PointerLockControls.js"></script>
	<script>
		// Check if the device supports pointer lock API
		if ('pointerLockElement' in document ||
			'mozPointerLockElement' in document ||
			'webkitPointerLockElement' in document) {

			var blocker = document.getElementById('canvas');
			var instructions = document.createElement('div');
			instructions.textContent = 'Click to enable pointer lock';
			instructions.style.position = 'absolute';
			instructions.style.color = '#fff';
			instructions.style.top = '50%';
			instructions.style.left = '50%';
			instructions.style.transform = 'translate(-50%, -50%)';
			blocker.appendChild(instructions);

			var havePointerLock =
				'pointerLockElement' in document ||
				'mozPointerLockElement' in document ||
				'webkitPointerLockElement' in document;

			if (havePointerLock) {
				var element = document.body;

				var pointerlockchange = function (event) {
					if (document.pointerLockElement === element ||
						document.mozPointerLockElement === element ||
						document.webkitPointerLockElement === element) {
						controls.enabled = true;
						instructions.style.display = 'none';
					} else {
						controls.enabled = false;
						instructions.style.display = 'block';
					}
				};

				var pointerlockerror = function (event) {
					instructions.style.display = 'block';
				};

				// Hook pointer lock state change events
				document.addEventListener('pointerlockchange', pointerlockchange, false);
				document.addEventListener('mozpointerlockchange', pointerlockchange, false);
				document.addEventListener('webkitpointerlockchange', pointerlockchange, false);

				document.addEventListener('pointerlockerror', pointerlockerror, false);
				document.addEventListener('mozpointerlockerror', pointerlockerror, false);
				document.addEventListener('webkitpointerlockerror', pointerlockerror, false);

				instructions.addEventListener('click', function (event) {
					instructions.style.display = 'none';

					// Ask the browser to lock the pointer
					element.requestPointerLock =
						element.requestPointerLock ||
						element.mozRequestPointerLock ||
						element.webkitRequestPointerLock;

					if (/Firefox/i.test(navigator.userAgent)) {
						var fullscreenchange = function (event) {
							if (document.fullscreenElement === element ||
								document.mozFullscreenElement === element ||
								document.mozFullScreenElement === element) {
								document.removeEventListener('fullscreenchange', fullscreenchange);
								document.removeEventListener('mozfullscreenchange', fullscreenchange);
								element.requestPointerLock();
							}
						};

						document.addEventListener('fullscreenchange', fullscreenchange, false);
						document.addEventListener('mozfullscreenchange', fullscreenchange, false);

						element.requestFullscreen =
							element.requestFullscreen ||
							element.mozRequestFullscreen ||
							element.mozRequestFullScreen ||
							element.webkitRequestFullscreen;

						element.requestFullscreen();
					} else {
						element.requestPointerLock();
					}
				}, false);
			}
		} else {
			instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';
		}

		// Create a scene
		var scene = new THREE.Scene();

		// Create a camera
		var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

		// Create a renderer
		var renderer = new THREE.WebGLRenderer({ antialias: true });
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.getElementById('canvas').appendChild(renderer.domElement);

		// Load the GLB model
		var loader = new THREE.GLTFLoader();
		loader.load('Sp_A.glb', function (gltf) {
			var model = gltf.scene;
			scene.add(model);
		});

		// Add ambient light
		scene.add(new THREE.AmbientLight(0x404040));

		// Add directional light
		var light = new THREE.DirectionalLight(0xffffff);
		light.position.set(0, 1, 1).normalize();
		scene.add(light);

		// Create controls
		var controls = new THREE.PointerLockControls(camera);
		scene.add(controls.getObject());

		// Handle window resizing
		window.addEventListener('resize', function () {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		});

		// Handle keydown events
		var onKeyDown = function (event) {
			switch (event.keyCode) {
				case 38: // up
				case 87: // w
					controls.moveForward(0.1);
					break;
				case 37: // left
				case 65: // a
					controls.moveRight(-0.1);
					break;
				case 40: // down
				case 83: // s
					controls.moveForward(-0.1);
					break;
				case 39: // right
				case 68: // d
					controls.moveRight(0.1);
					break;
				case 81: // zoom in (Q key)
					camera.zoom -= 0.1;
					camera.updateProjectionMatrix();
					break;
				case 69: // zoom out (E key)
					camera.zoom += 0.1;
					camera.updateProjectionMatrix();
					break;
			}
		};

		// Handle keyup events
		var onKeyUp = function (event) { };

		// Bind event listeners
		document.addEventListener('keydown', onKeyDown, false);
		document.addEventListener('keyup', onKeyUp, false);

		// Render the scene
		var animate = function () {
			requestAnimationFrame(animate);
			renderer.render(scene, camera);
		};

		animate();
	</script>
</body>
</html>
